---
title: "HR Analysis - Factors important to retain performing employees"
runtime: shiny
output: 
  html_document:
    fig_width: 14
    fig_height: 8
    out_width: '900px'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(dplyr)
library(ggplot2)
```

#### Problem
Factors important to retain performing employees

#### Data
https://www.kaggle.com/ludobenistant/hr-analytics

https://www.kaggle.com/ludobenistant/hr-analytics/downloads/human-resources-analytics.zip


```{r}


#Description of data set
description =  c(
  "Employee satisfaction level",
  "Last evaluation",
  "Number of projects",
  "Average monthly hours",
  "Time spent at the company",
  "Whether they have had a work accident",
  "Whether they have had a promotion in the last 5 years",
  "Sales",
  "Salary",
  "Whether the employee has left"
)
dataDescription <- function(hr_data) {
  return(str(hr_data))
  
}

#load Data Set
hrDF <- function() {
  hr_efficiency <- read.csv("./HR_comma_sep.csv", header = TRUE)
  hr_efficiency$promotion_last_5years <-
    as.factor(hr_efficiency$promotion_last_5years)
  hr_efficiency$left <- as.factor(hr_efficiency$left)
  hr_efficiency$Work_accident <-
    as.factor(hr_efficiency$Work_accident)
  hr_efficiency$number_project <-
    as.factor(hr_efficiency$number_project)
  hr_efficiency$last_eval_in_range = cut(hr_efficiency$last_evaluation, c(0, 0.2, 0.4, 0.6, 0.8, 1))
  hr_efficiency$monthly_avg_hrs_in_range <-
    cut(hr_efficiency$average_montly_hours,
        c(0, 50, 10, 150, 200, 250, 300, 350))
  hr_efficiency$time_spend_company_in_range <-
    cut(hr_efficiency$time_spend_company, c(0,  4, 8, 10, 12, 14))
  hr_efficiency$total_emp <- NROW(hr_efficiency)
  names(hr_efficiency)[9] <- "dept"
  return(hr_efficiency)
}
hr <- hrDF()
```

#Data Structure
```{r}
data_desc <- dataDescription(hr)
data_desc
```
##Higher turnover rate observed for employees who are under 5 years
###Large percent of employees fall in this category

```{r}
par(cex.axis=10, cex.lab=10)
plot_tm_spend <- hr %>% 
  ggplot(aes(time_spend_company, fill = left)) + 
  geom_histogram() + 
  facet_grid(. ~ dept) +
  labs(x = "Time spend in company (in years)", y = "employees")
plot_tm_spend
```

##Across departmentst 2-4 projects seems to provide better percent of employee retention

```{r}
plot_num_prj <- hr %>% 
  ggplot(aes(as.numeric(number_project), fill = left)) + 
  geom_histogram() + 
  facet_grid(. ~ dept) +
  labs(x = "Number of projects in a year", y = "employees")
plot_num_prj
```

##Looks like employees having evaluation rating of 0.7 having higher odds of staying 
###Also company's success rate in retaining performaing employees beyong 0.7 is poor

```{r}
plot_lst_eval <- hr %>% 
  ggplot(aes(as.numeric(last_evaluation), fill = left)) + 
  geom_histogram() + 
  facet_grid(. ~ dept) +
  labs(x = "Latest evaluation rating", y = "employees")
plot_lst_eval
```


##Company faring well in retaining employees having average monthly utilization of around 200 hours
###Company performs poorly in retianing employees lower and higher spectrum of 200 hours
```{r}
plot_avg_montly_hrs <- hr %>% 
  ggplot(aes(average_montly_hours, fill = left)) + 
  geom_histogram() + 
  facet_grid(. ~ dept) +
  labs(x = "Average monthly untilization (in hours)", y = "employees")
plot_avg_montly_hrs
```

